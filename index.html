<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Formulario de Registro - Colaboradores</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet" />
    <style>
      /* Aquí va tu CSS completo igual que antes */
      /* ... (omitido para no repetir) */
    </style>
</head>
<body>
<div class="container">
  <h1>Formulario de Registro de Colaboradores</h1>
  <form id="registro-form">
    <!-- Tus campos aquí (idénticos al código que diste) -->
    <!-- ... -->
    <!-- Botón de Envío -->
    <button type="submit" id="btn-enviar" class="btn btn-primary">Enviar Formulario</button>
  </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.6/dist/signature_pad.umd.min.js"></script>

<script>
  let signaturePadColaborador, signaturePadJefe;

  document.addEventListener('DOMContentLoaded', function () {
    const canvasColaborador = document.getElementById('firma-colaborador');
    canvasColaborador.width = canvasColaborador.offsetWidth;
    canvasColaborador.height = 150;
    signaturePadColaborador = new SignaturePad(canvasColaborador, {
      backgroundColor: 'rgba(255, 255, 255, 0)',
      penColor: 'rgb(0, 0, 0)',
      minWidth: 1,
      maxWidth: 3,
    });

    const canvasJefe = document.getElementById('firma-jefe');
    canvasJefe.width = canvasJefe.offsetWidth;
    canvasJefe.height = 150;
    signaturePadJefe = new SignaturePad(canvasJefe, {
      backgroundColor: 'rgba(255, 255, 255, 0)',
      penColor: 'rgb(0, 0, 0)',
      minWidth: 1,
      maxWidth: 3,
    });

    document.getElementById('clear-colaborador').addEventListener('click', () => signaturePadColaborador.clear());
    document.getElementById('clear-jefe').addEventListener('click', () => signaturePadJefe.clear());

    document.getElementById('registro-form').addEventListener('submit', function (e) {
      e.preventDefault();
      enviarFormulario();
    });
  });

  function mostrarAlerta(mensaje, tipo) {
    const alertaAnterior = document.querySelector('.alert');
    if (alertaAnterior) alertaAnterior.remove();

    const alerta = document.createElement('div');
    alerta.className = `alert alert-${tipo}`;
    alerta.textContent = mensaje;
    document.body.appendChild(alerta);

    setTimeout(() => {
      alerta.style.opacity = '0';
      setTimeout(() => alerta.remove(), 500);
    }, 5000);
  }

  function enviarFormulario() {
    const btnEnviar = document.getElementById('btn-enviar');
    btnEnviar.disabled = true;
    btnEnviar.textContent = 'Enviando...';

    if (signaturePadColaborador.isEmpty() || signaturePadJefe.isEmpty()) {
      mostrarAlerta('Error: Ambas firmas son requeridas', 'error');
      btnEnviar.disabled = false;
      btnEnviar.textContent = 'Enviar Formulario';
      return;
    }

    const selectVacaciones = document.getElementById('vacaciones');
    if (!selectVacaciones.value) {
      mostrarAlerta('Error: Debe seleccionar una opción para vacaciones', 'error');
      btnEnviar.disabled = false;
      btnEnviar.textContent = 'Enviar Formulario';
      return;
    }

    const datos = {
      rol: document.getElementById('rol').value.trim(),
      nombre: document.getElementById('nombre').value.trim(),
      numero: document.getElementById('numero').value.trim(),
      fecha: document.getElementById('fecha').value,
      email: document.getElementById('email').value.trim(),
      password: document.getElementById('password').value,
      vacaciones: selectVacaciones.value,
      jefe: document.getElementById('jefe').value.trim(),
      correoJefe: document.getElementById('correoJefe').value.trim(),
      tituloEvento: document.getElementById('tituloEvento').value.trim(),
      invitados: document.getElementById('invitados').value
        .split(',')
        .map((item) => item.trim())
        .filter((item) => item),
      descripcion: document.getElementById('descripcion').value.trim(),
      mensaje: document.getElementById('mensaje').value.trim(),
      firmaColaborador: signaturePadColaborador.toDataURL('image/png'),
      firmaJefe: signaturePadJefe.toDataURL('image/png'),
      timestamp: new Date().toISOString(),
    };

    const camposRequeridos = [
      'rol',
      'nombre',
      'numero',
      'fecha',
      'email',
      'vacaciones',
      'jefe',
      'correoJefe',
    ];
    const camposFaltantes = camposRequeridos.filter((campo) => !datos[campo]);

    if (camposFaltantes.length > 0) {
      mostrarAlerta(
        `Error: Faltan campos obligatorios: ${camposFaltantes.join(', ')}`,
        'error'
      );
      btnEnviar.disabled = false;
      btnEnviar.textContent = 'Enviar Formulario';
      return;
    }

    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxDoYg7-1BQgLu_IrNr3kUi7KIbr0JJoK9rit2CKxjuokYrDhC7JLXQrTTaMrtcjhbAPg/exec'; // Cambia por tu URL

    fetch(SCRIPT_URL, {
      method: 'POST',
      body: JSON.stringify(datos),
      headers: {
        'Content-Type': 'application/json',
      },
    })
      .then((response) => {
        if (!response.ok) throw new Error('Error en la respuesta del servidor');
        return response.json();
      })
      .then((resultado) => {
        if (resultado.status === 'success') {
          mostrarAlerta('Formulario enviado correctamente', 'success');
          document.getElementById('registro-form').reset();
          signaturePadColaborador.clear();
          signaturePadJefe.clear();
        } else {
          throw new Error(resultado.message || 'Error desconocido');
        }
      })
      .catch((error) => {
        console.error('Error:', error);
        mostrarAlerta(`Error al enviar el formulario: ${error.message}`, 'error');
      })
      .finally(() => {
        btnEnviar.disabled = false;
        btnEnviar.textContent = 'Enviar Formulario';
      });
  }
</script>
</body>
</html>
